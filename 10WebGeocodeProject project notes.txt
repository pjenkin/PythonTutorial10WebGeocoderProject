Order of steps:


https://pandas.pydata.org/pandas-docs/version/0.23.4/generated/pandas.DataFrame.to_html.html            return self.dataframe.to_html(classes='geocoded')
https://docs.python.org/3/library/unittest.html - Address & Name? Address present check? known geocoding result? dataframe html or is this testing pandas?
iterator/generator over CSV ? https://stackoverflow.com/questions/519633/lazy-method-for-reading-big-file-in-python
OOP - class WebGeocoder - upload()  download()  geocode()
CSS - colours, font sizes
name of CSS file - https://stackoverflow.com/questions/4831660/default-css-filename https://www.lifewire.com/naming-css-style-sheet-files-3466881 - no definite convention - sometimes complex/large apps will have separate layout.css (for position) design.css (for colour, size &c), and maybe my_subpage.css eg for separate pages
https://html.com/tags/doctype/  start with <!DOCTYPE html>
Color Picker  http://www.iconico.com/colorpic/gettingStarted.aspx  - but only about 10 colour picks for free 


TODO: shift first commits to develop branch

(1) app = Flask(__name__); - had to be declared outside class; (2) Flask @app.route def-s for render_template cannot be declared as methods of a class: must be outside class; (3) app = Flask(__name__) at top and if __name__ == '__main__':    app.run(debug=True) at bottom
WebGeocoder class put into separate file webgeocoder.py and imported - upload(file) method checked simply by printing filename in console. Could test this.

TODO Flask testing - https://pythonhosted.org/Flask-Testing/ - 



{{myvar|safe}}  - |safe flag if jinja 2'ing HTML string into page (HTML escaped otherwise)

isinstance - to test whether variable has been set yet to a Pandas Dataframe
self.dataframe.columns = map(str.lower, self.dataframe.columns)          # series/column names to lower case https://stackoverflow.com/a/36362607

    def geocode_dataframe(self):
        if not isinstance(self.dataframe, pandas.DataFrame):                # https://stackoverflow.com/a/14809149
            raise Exception('Dataframe not yet initialised: import CSV to proceed')
        if not 'address' in self.dataframe.columns and not 'Address' in self.dataframe.columns:
            raise Exception('No Address or address column in CSV')
        self.dataframe.columns = map(str.lower, self.dataframe.columns)
        # series/column names to lower case https://stackoverflow.com/a/36362607

        nom = Nominatim()
        self.dataframe['Latitude'], self.dataframe['Longitude'] = zip(*self.dataframe['address'].apply(nom.geocode).apply(lambda record: (record.latitude, record.longitude) ))
        # lambda assignation of lat/lng in geocoded dataframe https://stackoverflow.com/a/31414616
	# unpacking lat/lng tuple using zip and * https://stackoverflow.com/a/43009150

        self.dataframe.columns = map(str.title, self.dataframe.columns)
        # set to initial - really should restore to whatever previously

TODO https://stackoverflow.com/questions/50284753/warning-message-while-running-flask/50285851  Environment:production   & .env file


            return self.dataframe.to_csv(index=False)
  
@app.route('/download')
def download():
    print('In download')
    geocoded_filename = 'geocoded_' + webgeocoder.get_uploaded_filename()
    print(geocoded_filename)
    response = make_response(webgeocoder.download_csv_from_dataframe())
    response.headers['Content-Disposition'] = 'attachment; filename=' + geocoded_filename
    response.headers['Content-Type'] = 'text/csv'
    return response
    # Flask download CSV from pandas dataframe - https://stackoverflow.com/a/38635222

28/3/19

NB pandas Dataframe direct from list or dictionary https://pbpython.com/pandas-list-dict.html

child templates 10-145 - trouble getting flask child/parent blocks to display - layout.html in which to house index, map, graph &c - render child('index.html') (extends layout) not parent 

pip3 install gunicorn

TODO: packages - developing https://www.pythoncentral.io/how-to-create-a-python-package/   -   https://python-packaging.readthedocs.io/en/latest/


heroku 10-148 et seq
requirements.txt Profile runtime.txt

C:\Users\peter.DESKTOP-3GCVT7E\source\repos\Python\python mega course\10WebGeocoderProject>git add runtime.txt

C:\Users\peter.DESKTOP-3GCVT7E\source\repos\Python\python mega course\10WebGeocoderProject>git add requirements.txt

C:\Users\peter.DESKTOP-3GCVT7E\source\repos\Python\python mega course\10WebGeocoderProject>git add Procfile

C:\Users\peter.DESKTOP-3GCVT7E\source\repos\Python\python mega course\10WebGeocoderProject>git commit -am "22-241 Prep for Heroku push"
[master 1cbe4c2] 22-241 Prep for Heroku push
 4 files changed, 102 insertions(+), 3 deletions(-)
 create mode 100644 Procfile
 create mode 100644 requirements.txt
 create mode 100644 runtime.txt

C:\Users\peter.DESKTOP-3GCVT7E\source\repos\Python\python mega course\10WebGeocoderProject>heroku git:remote --app pnj-python-web-geocoder
 »   Warning: heroku update available from 7.18.9 to 7.20.1
set git remote heroku to https://git.heroku.com/pnj-python-web-geocoder.git

C:\Users\peter.DESKTOP-3GCVT7E\source\repos\Python\python mega course\10WebGeocoderProject>git push heroku
Enumerating objects: 79, done.
Counting objects: 100% (79/79), done.
Delta compression using up to 4 threads
Compressing objects: 100% (71/71), done.
Writing objects: 100% (79/79), 857.64 KiB | 8.75 MiB/s, done.
Total 79 (delta 36), reused 0 (delta 0)
remote: Compressing source files... done.
remote: Building source:
remote:
..... and so on (forgot to 'git feeze > requirements' from venv, from ordinary prompt instead, so lots of unecessary global packages (compressed to 178Mb?) went onto Heroku - oops - git push'ing a corrected requirements.txt led to Heroku uninstalling surplus pakages)

https://pnj-python-web-geocoder.herokuapp.com/

python -m unittest discover   - need to have 'test' at start of filename by default e.g. test_webgeocoder.py - python -m unittest test_webgeocoder      if not discovered

Output if Pyunit test(s) passing:
Ran 1 test in 0.005s
OK


for Flask testing:    https://urllib3.readthedocs.io/en/latest/    https://pythonhosted.org/Flask-Testing/  https://damyanon.net/post/flask-series-testing/
pip3 install urllib3
pip3 freeze > requirements.txt
... uninstalled urllib3 & flask_testing and ran pip3 freeze > requirements.txt    again

NB @classmethod    https://www.programiz.com/python-programming/methods/built-in/classmethod

TODO: pickling & scraping

        str_bytes = bytes(csv_string, 'utf-8')

        print('bytes: ' + bytes.decode(str_bytes))
        # bytes = b'''ID, address, People
        # 1,44 Mead Crescent Southampton, 4
        # 2, 67 Trevingey Road, 3
        # 3, 66 Mount Pleasant Road Camborne,2'''

        # self.app.post('/', data=dict(file_name=file))

        data = {'name':'some name'}
        data['file_name']=(BytesIO(str_bytes), test_file_name)
        # https: // stackoverflow.com / a / 35712344

        # self.app.post('/', data=dict(file_name=file), content_type='multipart/form-data')
        self.app.post('/', data=data, content_type='multipart/form-data')
        # POST to index, using 'frankenstein file'   http://flask.pocoo.org/docs/0.12/testing/


        downloaded_file = self.app.get('/download')

DeprecationWarning: Using Nominatim with the default "geopy/1.19.0" `user_agent` is strongly discouraged, as it violates Nominatim's ToS https://operations.osmfoundation.org/policies/nominatim/ and may possibly cause 403 and 429 HTTP errors. Please specify a custom `user_agent` with `Nominatim(user_agent="my-application")` or by overriding the default `user_agent`: `geopy.geocoders.options.default_user_agent = "my-application"`. In geopy 2.0 this will become an exception.    ?? https://stackoverflow.com/a/16634024 ??

29/3/18

Folium map
    # ._repr_html_()  to render map HTML in iframe   -  .get_root().render() to render whole page in HTML     
    # - https://github.com/python-visualization/folium/issues/781#issuecomment-347907408

Folium map tile types: https://deparkes.co.uk/2016/06/10/folium-map-tiles/
            atlas = folium.Map(location=[51, -4], zoom_start=7, tiles='mapquestopen', attr='http://open.mapquest.co.uk/')   - NB attr/attribution of tile source
            # tiles attribution - https://stackoverflow.com/a/52172546

renamed 'map' variable to 'atlas' (and to atlas.html) as confusion with standard map function and map route function was occurring.

Need to do stuff such as try to check/keep using dataframe if user navigated away from & back to home page - stick to MVP, basic map working, so get basic Bokeh chart working too.

Bokeh 17 et seq and 20-227
TODO: figure out apply and map (and lambda functions)

